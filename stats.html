<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistik - ndiidepzXmusic</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .stats-section {
            padding: 40px 0;
        }
        
        .stats-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background-color: var(--secondary);
            border-radius: 10px;
            padding: 25px;
            text-align: center;
        }
        
        .stat-icon {
            font-size: 40px;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 14px;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .chart-card {
            background-color: var(--secondary);
            border-radius: 10px;
            padding: 25px;
        }
        
        .chart-card h3 {
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .chart-placeholder {
            height: 200px;
            background: linear-gradient(45deg, var(--dark), var(--dark-gray));
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray);
        }
        
        .top-list {
            list-style: none;
        }
        
        .top-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px 0;
            border-bottom: 1px solid var(--dark-gray);
        }
        
        .top-item:last-child {
            border-bottom: none;
        }
        
        .rank {
            font-weight: bold;
            color: var(--primary);
            min-width: 30px;
        }
        
        .item-info {
            flex: 1;
        }
        
        .item-title {
            font-weight: 500;
        }
        
        .item-subtitle {
            color: var(--gray);
            font-size: 12px;
        }
        
        .item-count {
            color: var(--primary);
            font-weight: bold;
        }
        
        .time-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .time-stat {
            text-align: center;
            padding: 15px;
            background-color: var(--dark);
            border-radius: 5px;
        }
        
        .time-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .time-label {
            font-size: 12px;
            color: var(--gray);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-music"></i>
                    <h1>ndiidepzX<span>music</span></h1>
                </div>
                
                <!-- Contoh navigasi yang sama di semua halaman -->
<div class="nav-links">
    <a href="docs.html">Beranda</a>
    <a href="explore.html">Jelajahi</a>
    <a href="search-users.html">Cari User</a>
    <a href="search-artists.html">Cari Artist</a>
    <a href="playlists.html">Playlist</a>
    <a href="stats.html">Statistik</a>
    <a href="request.html">Request</a>
    <a href="help.html">Bantuan</a>
    <a href="profile.html">Profil</a>
</div>
                
                <div class="user-actions">
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <span id="username">User</span>
                    </div>
                    <button class="btn btn-outline" onclick="logout()">Keluar</button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Stats Section -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-header">
                <h2>Statistik Dengarkan Anda</h2>
                <p>Lihat kebiasaan dan preferensi musik Anda</p>
            </div>
            
            <!-- Overview Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-number" id="totalListenTime">0 jam</div>
                    <div class="stat-label">Total Waktu Dengarkan</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-play-circle"></i>
                    </div>
                    <div class="stat-number" id="totalPlays">0</div>
                    <div class="stat-label">Total Lagu Diputar</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="stat-number" id="totalFavorites">0</div>
                    <div class="stat-label">Lagu Favorit</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="stat-number" id="totalSearches">0</div>
                    <div class="stat-label">Total Pencarian</div>
                </div>
            </div>
            
            <!-- Charts and Lists -->
            <div class="charts-grid">
                <!-- Most Played Songs -->
                <div class="chart-card">
                    <h3><i class="fas fa-music"></i> Lagu Paling Sering Diputar</h3>
                    <div class="top-list" id="mostPlayedList">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Most Searched Terms -->
                <div class="chart-card">
                    <h3><i class="fas fa-search"></i> Pencarian Terbanyak</h3>
                    <div class="top-list" id="mostSearchedList">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Favorite Genres -->
                <div class="chart-card">
                    <h3><i class="fas fa-star"></i> Genre Favorit</h3>
                    <div class="top-list" id="favoriteGenresList">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Listening Hours -->
                <div class="chart-card">
                    <h3><i class="fas fa-chart-bar"></i> Jam Dengarkan</h3>
                    <div class="chart-placeholder">
                        <p>Grafik Jam Dengarkan</p>
                    </div>
                    <div class="time-stats" id="listeningHours">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="chart-card">
                <h3><i class="fas fa-history"></i> Aktivitas Terbaru</h3>
                <div class="top-list" id="recentActivity">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </section>
    
    <script src="music-data.js"></script>
    <script src="url.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const isLoggedIn = localStorage.getItem('ndiidepzXmusic_loggedIn');
            
            if (!isLoggedIn) {
                window.location.href = 'login.html';
                return;
            }
            
            // Load user data
            const userData = getCurrentUserData();
            if (userData) {
                loadStatistics(userData);
            }
        });
        
        function loadStatistics(userData) {
            const stats = userData.statistics;
            const history = userData.history;
            
            // Update overview stats
            document.getElementById('totalListenTime').textContent = 
                Math.round(stats.totalPlayTime / 3600) + ' jam';
            document.getElementById('totalPlays').textContent = 
                history.playedSongs.length;
            document.getElementById('totalFavorites').textContent = 
                userData.favorites.songs.length;
            document.getElementById('totalSearches').textContent = 
                history.searchedTerms.length;
            
            // Load most played songs
            loadMostPlayedSongs(stats.mostPlayedSongs);
            
            // Load most searched terms
            loadMostSearchedTerms(stats.mostSearchedTerms);
            
            // Load favorite genres
            loadFavoriteGenres(stats.favoriteGenres);
            
            // Load listening hours
            loadListeningHours(stats.listeningHours);
            
            // Load recent activity
            loadRecentActivity(history.playedSongs);
        }
        
        function loadMostPlayedSongs(mostPlayed) {
            const container = document.getElementById('mostPlayedList');
            container.innerHTML = '';
            
            const topSongs = mostPlayed.slice(0, 5);
            
            if (topSongs.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--gray);">Belum ada data</p>';
                return;
            }
            
            topSongs.forEach((song, index) => {
                const item = document.createElement('div');
                item.className = 'top-item';
                item.innerHTML = `
                    <div class="rank">${index + 1}</div>
                    <div class="item-info">
                        <div class="item-title">${song.title}</div>
                        <div class="item-subtitle">${song.artist}</div>
                    </div>
                    <div class="item-count">${song.count}x</div>
                `;
                container.appendChild(item);
            });
        }
        
        function loadMostSearchedTerms(mostSearched) {
            const container = document.getElementById('mostSearchedList');
            container.innerHTML = '';
            
            const topSearches = mostSearched.slice(0, 5);
            
            if (topSearches.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--gray);">Belum ada data</p>';
                return;
            }
            
            topSearches.forEach((search, index) => {
                const item = document.createElement('div');
                item.className = 'top-item';
                item.innerHTML = `
                    <div class="rank">${index + 1}</div>
                    <div class="item-info">
                        <div class="item-title">"${search.term}"</div>
                    </div>
                    <div class="item-count">${search.count}x</div>
                `;
                container.appendChild(item);
            });
        }
        
        function loadFavoriteGenres(genres) {
            const container = document.getElementById('favoriteGenresList');
            container.innerHTML = '';
            
            const topGenres = genres.slice(0, 5);
            
            if (topGenres.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--gray);">Belum ada data</p>';
                return;
            }
            
            topGenres.forEach((genre, index) => {
                const item = document.createElement('div');
                item.className = 'top-item';
                item.innerHTML = `
                    <div class="rank">${index + 1}</div>
                    <div class="item-info">
                        <div class="item-title">${genre.genre}</div>
                    </div>
                    <div class="item-count">${genre.count}x</div>
                `;
                container.appendChild(item);
            });
        }
        
        function loadListeningHours(hours) {
            const container = document.getElementById('listeningHours');
            container.innerHTML = '';
            
            // Get top 4 hours
            const topHours = Object.entries(hours)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 4);
            
            if (topHours.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--gray); grid-column: 1/-1;">Belum ada data</p>';
                return;
            }
            
            topHours.forEach(([hour, count]) => {
                const timeStat = document.createElement('div');
                timeStat.className = 'time-stat';
                timeStat.innerHTML = `
                    <div class="time-value">${hour}:00</div>
                    <div class="time-label">${count} lagu</div>
                `;
                container.appendChild(timeStat);
            });
        }
        
        function loadRecentActivity(playedSongs) {
            const container = document.getElementById('recentActivity');
            container.innerHTML = '';
            
            const recent = playedSongs.slice(0, 5);
            const musicLibrary = getDefaultMusicLibrary();
            
            if (recent.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--gray);">Belum ada aktivitas</p>';
                return;
            }
            
            recent.forEach(activity => {
                const song = musicLibrary.songs.find(s => s.id === activity.songId);
                if (song) {
                    const item = document.createElement('div');
                    item.className = 'top-item';
                    
                    const time = new Date(activity.timestamp);
                    const timeString = time.toLocaleTimeString('id-ID', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    item.innerHTML = `
                        <div class="item-info" style="flex: 1;">
                            <div class="item-title">${song.title}</div>
                            <div class="item-subtitle">${song.artist} â€¢ ${timeString}</div>
                        </div>
                        <i class="fas fa-play" style="color: var(--primary);"></i>
                    `;
                    container.appendChild(item);
                }
            });
        }
        
        function logout() {
            localStorage.removeItem('ndiidepzXmusic_loggedIn');
            localStorage.removeItem('ndiidepzXmusic_currentUser');
            localStorage.removeItem('ndiidepzXmusic_username');
            localStorage.removeItem('ndiidepzXmusic_userEmail');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
